#!/bin/bash

# Float the focused window and center it at 40% width, 70% height

set -euo pipefail

window_info=$(aerospace list-windows --focused --format '%{window-id}|%{app-name}' 2>/dev/null | head -1)
[[ -z "$window_info" ]] && exit 1

window_id=${window_info%%|*}
app_name=${window_info##*|}

aerospace layout floating --window-id "$window_id"

osascript <<EOF
use framework "AppKit"

tell application "System Events" to set {winX, winY} to position of front window of process "$app_name"

set targetScreen to missing value
repeat with s in (current application's NSScreen's screens())
    set {{sX, sY}, {sW, sH}} to s's frame()
    if winX >= sX and winX < sX + sW then
        set targetScreen to s
        exit repeat
    end if
end repeat
if targetScreen is missing value then set targetScreen to current application's NSScreen's mainScreen()

set {{vX, vY}, {vW, vH}} to targetScreen's visibleFrame()
set {w, h} to {(vW * 0.4) as integer, (vH * 0.7) as integer}

tell application "System Events" to set size of front window of process "$app_name" to {w, h}

set mainH to item 2 of item 2 of (current application's NSScreen's mainScreen()'s frame())
set {x, y} to {(vX + (vW - w) / 2) as integer, ((mainH - vY - vH) + (vH - h) / 2) as integer}

tell application "System Events" to set position of front window of process "$app_name" to {x, y}
EOF
